<html>

<script src="http://apps.bdimg.com/libs/jquery/2.0.0/jquery.min.js"></script>
<link href="http://apps.bdimg.com/libs/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">
<script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>

<script>
	var baseUrl ="http://"+location.host;
	$(document).ready(function() {
		// GET /report?date=20160825
		$("#btn_gen").on("click", function() {
			var yyyy=document.cal.YYYY.value;
			var mm=addZero(document.cal.MM.value);
			var dd=addZero(document.cal.DD.value);
			var date = yyyy+mm+dd;
			$.ajax({
				url:baseUrl+"/report/",
				type:'GET',
				timeout : 5000,
				data: {date:date},
				contentType: "application/json",
				dataType: 'text',
				success: function (result) {
					document.getElementById("t_report").value = result
		          	},
		           error: function () {
		           	console.log(JSON.stringify(result))
				}
		    });
		});
		
		// copy
		$("#btn_copy").on("click", function() {
			copy("t_report");
		});
	});
	
	// 8 -> 08
	function addZero(str){
	    str ='00'+str;
	    return str.substring(str.length-2,str.length);
	}
	
	// copy
	function copy(id){
		var e=document.getElementById(id);
        e.select();
        document.execCommand("Copy");
	}
</script>

<div class="container">
	<div id="hint" style="display: none;">
		<p id="t_hint">No hint</p>
	</div>
	<form name="cal">
	  <select name="YYYY" onchange="YYYYDD(this.value)">
	    <option value="">选择 年</option>
	  </select>
	  <select name="MM" onchange="MMDD(this.value)">
	    <option value="">选择 月</option>
	  </select>
	  <select name="DD">
	    <option value="">选择 日</option>
	  </select>
	</form>
	<div>
		<button id="btn_gen" class="btn btn-large">生成</button>
		<button id="btn_copy" class="btn btn-large">复制全部</button>
	</div>
	<div>
		<textarea id="t_report" class="form-control" rows="30">Report</textarea>
	</div>
</div>

<script language="JavaScript">
   function YYYYMMDDstart()
   {
        MonHead = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        //先给年下拉框赋内容
        var y  = new Date().getFullYear();
        for (var i = y; i < (y+1); i++) //以今年为准，前30年，后30年  
                document.cal.YYYY.options.add(new Option(" "+ i +" 年", i));   

        //赋月份的下拉框
        for (var i = 1; i < 13; i++)
                document.cal.MM.options.add(new Option(" " + i + " 月", i));
 
        document.cal.YYYY.value = y;   
        document.cal.MM.value = new Date().getMonth() + 1;   
        var n = MonHead[new Date().getMonth()];   
        if (new Date().getMonth() ==1 && IsPinYear(YYYYvalue)) n++;   
             writeDay(n); //赋日期下拉框Author:meizz   
        document.cal.DD.value = new Date().getDate();   
   }   
   if(document.attachEvent)   
       window.attachEvent("onload", YYYYMMDDstart);   
   else   
       window.addEventListener('load', YYYYMMDDstart, false);   
   function YYYYDD(str) //年发生变化时日期发生变化(主要是判断闰平年)   
   {   
           var MMvalue = document.cal.MM.options[document.cal.MM.selectedIndex].value;   
           if (MMvalue == ""){ var e = document.cal.DD; optionsClear(e); return;}   
           var n = MonHead[MMvalue - 1];   
           if (MMvalue ==2 && IsPinYear(str)) n++;   
                writeDay(n)   
   }   
   function MMDD(str)   //月发生变化时日期联动   
   {   
        var YYYYvalue = document.cal.YYYY.options[document.cal.YYYY.selectedIndex].value;   
        if (YYYYvalue == ""){ var e = document.cal.DD; optionsClear(e); return;}   
        var n = MonHead[str - 1];   
        if (str ==2 && IsPinYear(YYYYvalue)) n++;   
       writeDay(n)   
   }   
   function writeDay(n)   //据条件写日期的下拉框   
   {   
           var e = document.cal.DD; optionsClear(e);   
           for (var i=1; i<(n+1); i++)   
                e.options.add(new Option(" "+ i + " 日", i));   
   }   
   function IsPinYear(year)//判断是否闰平年   
   {     return(0 == year%4 && (year%100 !=0 || year%400 == 0));}   
   function optionsClear(e)   
   {   
        e.options.length = 1;   
   }   
   </script>

</body>

</html>
